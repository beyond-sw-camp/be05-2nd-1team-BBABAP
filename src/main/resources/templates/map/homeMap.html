<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Kakao 지도 시작하기</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body>
<div id="wrapper" class="relative">
  <div id="map" class="w-screen h-screen">
  </div>

</div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f4e869be3367c0abfb655792d5e9ff5b"></script>
<script>
  // 사용자의 위치를 받아와서 지도를 생성하고 전기차 충전소 데이터를 표시하는 함수
  function showChargingStationsOnMap(userPosition) {
    var mapContainer = document.getElementById('map');
    var mapOption = {
      center: new kakao.maps.LatLng(userPosition.coords.latitude, userPosition.coords.longitude),
      level: 3
    };

    // 지도 생성
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 전기차 충전소 데이터 가져와서 표시
    fetch('/api/location')
            .then(response => response.text())
            .then(xmlData => {
              console.log(xmlData); // XML 데이터 확인용

              var parser = new DOMParser();
              var xmlDoc = parser.parseFromString(xmlData, 'text/xml');
              var chargingStations = xmlDoc.getElementsByTagName('item');

              console.log(chargingStations.length); // 전기차 충전소 개수 확인용

              for (var i = 0; i < chargingStations.length; i++) {
                var station = chargingStations[i];
                var name = station.getElementsByTagName('statNm')[0].childNodes[0].nodeValue;
                var lat = parseFloat(station.getElementsByTagName('lat')[0].childNodes[0].nodeValue);
                var lng = parseFloat(station.getElementsByTagName('lng')[0].childNodes[0].nodeValue);

                console.log(name, lat, lng); // 전기차 충전소 정보 확인용

                var markerPosition = new kakao.maps.LatLng(lat, lng);
                var marker = new kakao.maps.Marker({
                  position: markerPosition,
                  map: map,
                  title: name
                });
              }
            })
            .catch(error => {
              console.error('Error fetching charging stations:', error);
            });
  }

  // 현재 위치를 가져와서 함수 호출
  navigator.geolocation.getCurrentPosition(showChargingStationsOnMap);
</script>
</body>
</html>
